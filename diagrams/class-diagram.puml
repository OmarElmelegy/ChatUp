@startuml ChatSystem Class Diagram

skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam backgroundColor #FFFFFF
skinparam linetype ortho
skinparam class {
    BackgroundColor #FFFFCC
    BorderColor #000000
    ArrowColor #000000
}

' Interfaces
interface Runnable {
    + run() : void
}

' ========== SERVER SIDE ==========
package "Server Side" #DDFFDD {
    class ChatServer {
        {static} - PORT : int = 5001
        {static} - clients : List<ClientHandler>
        {static} - serverSocket : SSLServerSocket
        --
        {static} + main(String[] args) : void
        {static} + addClient(ClientHandler) : void
        {static} + removeClient(ClientHandler) : void
        {static} + broadcast(String, ClientHandler) : void
        {static} + broadcastAll(String) : void
        {static} + broadcastFile(String, byte[], ClientHandler) : void
        {static} + sendPrivateMessage(String, String, String, ClientHandler) : void
        {static} + getClients() : List<ClientHandler>
        {static} + shutdown() : void
    }

    class ClientHandler {
        - clientSocket : Socket
        - output : DataOutputStream
        - username : String
        {static} - formatter : DateTimeFormatter
        {static} - msgType_TEXT : byte = 1
        {static} - msgType_FILE : byte = 2
        --
        + ClientHandler(Socket)
        + run() : void
        + sendText(String) : void
        + sendFile(String, byte[]) : void
        + getUsername() : String
        {static} + getFormatter() : DateTimeFormatter
        + closeConnection() : void
    }
    
    note right of ChatServer
      Main server that accepts
      client connections and
      manages message routing
    end note

    note right of ClientHandler
      Handles individual client
      connections in separate threads
      Processes commands:
      - /list
      - /w <user> <msg>
      - bye
      Binary protocol:
      - msgType_TEXT (1): text messages
      - msgType_FILE (2): file transfers
      File size limit: 50MB
    end note
}

' ========== CLIENT SIDE ==========
package "Client Side" #DDDDFF {
    class ChatClient {
        {static} - PORT : int = 5001
        --
        {static} + main(String[] args) : void
    }

    class ClientGUI {
        - output : DataOutputStream
        - input : DataInputStream
        - socket : SSLSocket
        - username : String
        - intentionalClose : boolean
        {static} - SERVER_HOST : String
        {static} - PORT : int
        {static} - TIME_FORMATTER : DateTimeFormatter
        {static} - msgType_TEXT : byte = 1
        {static} - msgType_FILE : byte = 2
        --
        + start(Stage) : void
        + stop() : void
        {static} + main(String[] args) : void
    }

    class ServerListener {
        - socket : Socket
        --
        + ServerListener(Socket)
        + run() : void
    }
    
    note right of ChatClient
      Command-line client application
      Connects via SSL/TLS
      Sends user input to server
      and displays received messages
    end note

    note right of ClientGUI
      JavaFX GUI client application
      Provides modern interface
      with text area, input field,
      Send button, and File button
      Uses SSL/TLS encryption
      Binary protocol for messages
      and file transfers
      Supports silent window close
    end note

    note right of ServerListener
      Runs in separate thread
      to continuously receive
      messages from server
      (used by CLI client)
    end note
}

' Relationships within Server Side
ChatServer "1" -- "*" ClientHandler : manages >
ClientHandler ..|> Runnable : implements

' Relationships within Client Side
ChatClient ..> ServerListener : creates
ServerListener ..|> Runnable : implements
ClientGUI ..> javafx.application.Application : extends

' Cross-boundary relationships
ChatClient ..> ChatServer : connects to (SSL)
ClientGUI ..> ChatServer : connects to (SSL)
ClientHandler --> ChatServer : uses

@enduml
